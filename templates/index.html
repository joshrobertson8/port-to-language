<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Text Translator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Font Awesome for Icons (Optional but recommended) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Text Translator</h1>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('home') }}" class="translate-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="text">Enter text to translate:</label>
                <input type="text" id="text" name="text" placeholder="Type your text here...">
            </div>

            <div class="form-group">
                <label for="file">Or upload a file to translate:</label>
                <div id="drop-area" class="drop-area">
                    <i class="fas fa-file-upload fa-3x"></i>
                    <p>Drag & Drop your file here or click to upload</p>
                    <input type="file" id="file" name="file" accept=".txt,.pdf">
                </div>
            </div>

            <div class="form-group">
                <label for="target_language">Select target language:</label>
                <div class="select-wrapper">
                    <div class="custom-select" tabindex="0" role="combobox" aria-haspopup="listbox" aria-expanded="false">
                        <div class="select-selected" aria-label="Select target language">Select a language</div>
                        <div class="select-items" role="listbox">
                            <div role="option" tabindex="0">Spanish</div>
                            <div role="option" tabindex="0">French</div>
                            <div role="option" tabindex="0">German</div>
                            <div role="option" tabindex="0">Chinese</div>
                            <div role="option" tabindex="0">Japanese</div>
                            <div role="option" tabindex="0">Korean</div>
                            <div role="option" tabindex="0">Italian</div>
                            <div role="option" tabindex="0">Portuguese</div>
                            <div role="option" tabindex="0">Russian</div>
                            <div role="option" tabindex="0">Arabic</div>
                            <!-- Add more languages as needed -->
                        </div>
                    </div>
                    <!-- Hidden input to store the selected value -->
                    <input type="hidden" id="target_language" name="target_language" required aria-label="Selected target language">
                </div>
            </div>

            <div class="form-group">
                <button type="submit" class="action-button">Translate</button>
            </div>
        </form>

        {% if translation %}
            <h2>Translation:</h2>
            <div class="translation-output">
                <p id="translation-text">{{ translation }}</p>
                <div class="button-group">
                    <button id="copy-button" class="action-button" title="Copy to clipboard">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button id="share-button" class="action-button" title="Share translation">
                        <i class="fas fa-share-alt"></i> Share
                    </button>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- Share Modal -->
    <div id="share-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3>Share Translation</h3>
            <div class="share-options">
                <a href="#" id="share-facebook" target="_blank"><i class="fab fa-facebook-f"></i> Facebook</a>
                <a href="#" id="share-twitter" target="_blank"><i class="fab fa-twitter"></i> Twitter</a>
                <a href="#" id="share-email" target="_blank"><i class="fas fa-envelope"></i> Email</a>
                <a href="#" id="share-whatsapp" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                <!-- Add more platforms as needed -->
            </div>
        </div>
    </div>

    <!-- JavaScript for Custom Dropdown Functionality, Drag-and-Drop, and Button Actions -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Custom Dropdown Functionality
            const customSelect = document.querySelector('.custom-select');
            const selected = customSelect.querySelector('.select-selected');
            const optionsContainer = customSelect.querySelector('.select-items');
            const options = optionsContainer.querySelectorAll('div[role="option"]');
            const hiddenInput = document.getElementById('target_language');

            // Toggle dropdown on click
            selected.addEventListener('click', function(e) {
                e.stopPropagation();
                closeAllSelect(this);
                optionsContainer.classList.toggle('show');
                selected.classList.toggle('open');
                const isExpanded = selected.classList.contains('open');
                customSelect.setAttribute('aria-expanded', isExpanded);
            });

            // Handle option click
            options.forEach(function(option) {
                option.addEventListener('click', function(e) {
                    selected.innerText = this.innerText;
                    hiddenInput.value = this.innerText;
                    optionsContainer.classList.remove('show');
                    selected.classList.remove('open');
                    customSelect.setAttribute('aria-expanded', 'false');
                });
            });

            // Close all dropdowns if clicked outside
            document.addEventListener('click', closeAllSelect);

            function closeAllSelect(elmnt) {
                const allSelectItems = document.querySelectorAll('.select-items');
                const allSelected = document.querySelectorAll('.select-selected');
                allSelectItems.forEach(function(item) {
                    if (item !== optionsContainer) {
                        item.classList.remove('show');
                    }
                });
                allSelected.forEach(function(item) {
                    if (item !== selected) {
                        item.classList.remove('open');
                    }
                });
                // Update aria-expanded
                customSelect.setAttribute('aria-expanded', 'false');
            }

            // Keyboard accessibility
            customSelect.addEventListener('keydown', function(e) {
                const key = e.key;
                if (key === 'Enter' || key === ' ') {
                    e.preventDefault();
                    selected.click();
                } else if (key === 'ArrowDown') {
                    e.preventDefault();
                    if (!optionsContainer.classList.contains('show')) {
                        selected.click();
                    }
                    const firstOption = optionsContainer.querySelector('div[role="option"]');
                    if (firstOption) {
                        firstOption.focus();
                    }
                }
            });

            options.forEach(function(option) {
                option.addEventListener('keydown', function(e) {
                    const key = e.key;
                    if (key === 'Enter' || key === ' ') {
                        e.preventDefault();
                        this.click();
                    } else if (key === 'ArrowDown') {
                        e.preventDefault();
                        if (this.nextElementSibling) {
                            this.nextElementSibling.focus();
                        }
                    } else if (key === 'ArrowUp') {
                        e.preventDefault();
                        if (this.previousElementSibling) {
                            this.previousElementSibling.focus();
                        } else {
                            selected.focus();
                        }
                    }
                });
            });

            // Drag and Drop File Upload Functionality
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file');

            // Prevent default behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults (e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // Highlight drop area when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                dropArea.classList.add('highlight');
            }

            function unhighlight(e) {
                dropArea.classList.remove('highlight');
            }

            // Handle dropped files
            dropArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    // Display the file name
                    const fileName = files[0].name;
                    dropArea.querySelector('p').textContent = fileName;
                }
            }

            // Handle file input click
            dropArea.addEventListener('click', () => {
                fileInput.click();
            });

            // Handle file input change
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    const fileName = fileInput.files[0].name;
                    dropArea.querySelector('p').textContent = fileName;
                    // Optionally, auto-submit the form
                    // document.querySelector('.translate-form').submit();
                }
            });

            // Copy Button Functionality
            const copyButton = document.getElementById('copy-button');
            const translationText = document.getElementById('translation-text');

            copyButton.addEventListener('click', function() {
                const textToCopy = translationText.innerText;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    // Optional: Provide user feedback
                    copyButton.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy';
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                });
            });

            // Share Button Functionality with Fallback Modal
            const shareButton = document.getElementById('share-button');
            const shareModal = document.getElementById('share-modal');
            const closeButton = document.querySelector('.close-button');
            const shareFacebook = document.getElementById('share-facebook');
            const shareTwitter = document.getElementById('share-twitter');
            const shareEmail = document.getElementById('share-email');
            const shareWhatsApp = document.getElementById('share-whatsapp');
            // Add more platforms as needed

            shareButton.addEventListener('click', function() {
                const textToShare = translationText.innerText;
                if (navigator.share) {
                    navigator.share({
                        title: 'Translation',
                        text: textToShare,
                    }).then(() => {
                        console.log('Translation shared successfully');
                    }).catch((error) => {
                        console.error('Error sharing:', error);
                    });
                } else {
                    // Fallback: Open share modal
                    shareModal.style.display = 'block';

                    // Set share links dynamically
                    const encodedText = encodeURIComponent(textToShare);
                    const pageURL = encodeURIComponent(window.location.href);

                    shareFacebook.href = `https://www.facebook.com/sharer/sharer.php?u=${pageURL}&quote=${encodedText}`;
                    shareTwitter.href = `https://twitter.com/intent/tweet?text=${encodedText}&url=${pageURL}`;
                    shareEmail.href = `mailto:?subject=Translation&body=${encodedText}`;
                    shareWhatsApp.href = `https://api.whatsapp.com/send?text=${encodedText}`;
                    // Add more share links as needed
                }
            });

            // Close modal when clicking the close button
            closeButton.addEventListener('click', function() {
                shareModal.style.display = 'none';
            });

            // Close modal when clicking outside the modal content
            window.addEventListener('click', function(event) {
                if (event.target == shareModal) {
                    shareModal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
